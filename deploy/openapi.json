{"openapi":"3.1.0","info":{"title":"profiles-svc","version":"0.1.0"},"paths":{"/metrics":{"head":{"summary":"Metrics Head","operationId":"metrics_head_metrics_head","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/health":{"get":{"tags":["health"],"summary":"Health","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/health/metrics":{"get":{"tags":["health"],"summary":"Metrics","operationId":"metrics_health_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/profiles":{"get":{"tags":["profiles"],"summary":"List Profiles","operationId":"list_profiles_profiles_get","parameters":[{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Page number","default":1,"title":"Page"},"description":"Page number"},{"name":"size","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Page size","default":50,"title":"Size"},"description":"Page size"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Page_ProfileOut_"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["profiles"],"summary":"Create Profile","operationId":"create_profile_profiles_post","security":[{"HTTPBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/profiles/{profile_id}":{"get":{"tags":["profiles"],"summary":"Get Profile","operationId":"get_profile_profiles__profile_id__get","parameters":[{"name":"profile_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Profile Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"tags":["profiles"],"summary":"Update Profile","operationId":"update_profile_profiles__profile_id__put","security":[{"HTTPBearer":[]}],"parameters":[{"name":"profile_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Profile Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["profiles"],"summary":"Delete Profile","operationId":"delete_profile_profiles__profile_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"profile_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Profile Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/profiles/{profile_id}/photo":{"post":{"tags":["profiles"],"summary":"Upload Profile Photo","operationId":"upload_profile_photo_profiles__profile_id__photo_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"profile_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Profile Id"}}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_profile_photo_profiles__profile_id__photo_post"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/profiles/{profile_id}/history":{"get":{"tags":["profiles"],"summary":"List Profile History","operationId":"list_profile_history_profiles__profile_id__history_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"profile_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Profile Id"}},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Page number","default":1,"title":"Page"},"description":"Page number"},{"name":"size","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Page size","default":50,"title":"Size"},"description":"Page size"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Page_ProfileHistoryOut_"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/internal/profiles":{"post":{"tags":["internal"],"summary":"Create Profile Internal","description":"Internal endpoint used by auth-svc to ensure a Profile exists immediately after user registration.\n\nExpected payload: { \"user_id\": \"<uuid>\", \"email\": \"...\", \"display_name\": \"...\" }\nThis endpoint is intended for internal network calls from the auth service and does not\nrequire authentication. It's resilient to existing records (will upsert when possible).","operationId":"create_profile_internal_internal_profiles_post","requestBody":{"content":{"application/json":{"schema":{"type":"object","title":"Payload"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/internal/profiles/{user_id}/photo":{"post":{"tags":["internal"],"summary":"Upload Profile Photo Internal","description":"Internal multipart endpoint to upload a profile photo given a user_id.\n\nThis endpoint is intended to be called from auth-svc (service-to-service) so it\ndoes not require normal user authentication.","operationId":"upload_profile_photo_internal_internal_profiles__user_id__photo_post","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}}],"requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_profile_photo_internal_internal_profiles__user_id__photo_post"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/internal/profiles/verify":{"post":{"tags":["internal"],"summary":"Internal Verify Profile","description":"Internal endpoint used by auth-svc to sync email verification state.\n\nExpected payload: {\"user_id\": \"...\", \"email\": \"...\"}\nThis endpoint will set a lightweight flag inside the `services` JSON of the profile\n(services.email_verified = true). If no profile exists for the user_id, a minimal\nprofile record will be created.","operationId":"internal_verify_profile_internal_profiles_verify_post","requestBody":{"content":{"application/json":{"schema":{"type":"object","title":"Payload"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"Body_upload_profile_photo_internal_internal_profiles__user_id__photo_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"}},"type":"object","title":"Body_upload_profile_photo_internal_internal_profiles__user_id__photo_post"},"Body_upload_profile_photo_profiles__profile_id__photo_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"}},"type":"object","required":["file"],"title":"Body_upload_profile_photo_profiles__profile_id__photo_post"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"Page_ProfileHistoryOut_":{"properties":{"items":{"items":{"$ref":"#/components/schemas/ProfileHistoryOut"},"type":"array","title":"Items"},"total":{"type":"integer","minimum":0.0,"title":"Total"},"page":{"type":"integer","minimum":1.0,"title":"Page"},"size":{"type":"integer","minimum":1.0,"title":"Size"},"pages":{"type":"integer","minimum":0.0,"title":"Pages"}},"type":"object","required":["items","total","page","size","pages"],"title":"Page[ProfileHistoryOut]"},"Page_ProfileOut_":{"properties":{"items":{"items":{"$ref":"#/components/schemas/ProfileOut"},"type":"array","title":"Items"},"total":{"type":"integer","minimum":0.0,"title":"Total"},"page":{"type":"integer","minimum":1.0,"title":"Page"},"size":{"type":"integer","minimum":1.0,"title":"Size"},"pages":{"type":"integer","minimum":0.0,"title":"Pages"}},"type":"object","required":["items","total","page","size","pages"],"title":"Page[ProfileOut]"},"ProfileCreate":{"properties":{"display_name":{"type":"string","maxLength":100,"minLength":2,"title":"Display Name"},"role":{"$ref":"#/components/schemas/ProfileRole","default":"client"},"bio":{"anyOf":[{"type":"string","maxLength":500},{"type":"null"}],"title":"Bio"},"city":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"City"},"latitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Latitude"},"longitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Longitude"},"services":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Services"},"photo_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Photo Url"},"name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Name"},"second_name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Second Name"},"email":{"anyOf":[{"type":"string","format":"email"},{"type":"null"}],"title":"Email"},"document_type":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Document Type"},"document":{"anyOf":[{"type":"string","maxLength":50},{"type":"null"}],"title":"Document"},"department":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Department"},"postal_code":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Postal Code"},"street":{"anyOf":[{"type":"string","maxLength":120},{"type":"null"}],"title":"Street"},"number":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Number"},"apartment":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Apartment"},"birth_date":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Birth Date"}},"type":"object","required":["display_name"],"title":"ProfileCreate"},"ProfileHistoryOut":{"properties":{"history_id":{"type":"string","format":"uuid","title":"History Id"},"profile_id":{"type":"string","format":"uuid","title":"Profile Id"},"change_type":{"type":"string","title":"Change Type"},"changed_by":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Changed By"},"change_origin":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Change Origin"},"change_reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Change Reason"},"snapshot":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Snapshot"},"previous_snapshot":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Previous Snapshot"},"changed_at":{"type":"string","format":"date-time","title":"Changed At"}},"type":"object","required":["history_id","profile_id","change_type","changed_at"],"title":"ProfileHistoryOut"},"ProfileOut":{"properties":{"display_name":{"type":"string","title":"Display Name"},"role":{"$ref":"#/components/schemas/ProfileRole"},"bio":{"anyOf":[{"type":"string","maxLength":500},{"type":"null"}],"title":"Bio"},"city":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"City"},"latitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Latitude"},"longitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Longitude"},"services":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Services"},"photo_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Photo Url"},"name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Name"},"second_name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Second Name"},"email":{"anyOf":[{"type":"string","format":"email"},{"type":"null"}],"title":"Email"},"document_type":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Document Type"},"document":{"anyOf":[{"type":"string","maxLength":50},{"type":"null"}],"title":"Document"},"department":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Department"},"postal_code":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Postal Code"},"street":{"anyOf":[{"type":"string","maxLength":120},{"type":"null"}],"title":"Street"},"number":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Number"},"apartment":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Apartment"},"birth_date":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Birth Date"},"id":{"type":"string","format":"uuid","title":"Id"},"user_id":{"type":"string","title":"User Id"},"rating":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Rating"},"rating_count":{"type":"integer","title":"Rating Count","default":0},"created_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["display_name","role","id","user_id"],"title":"ProfileOut"},"ProfileRole":{"type":"string","enum":["client","provider"],"title":"ProfileRole"},"ProfileUpdate":{"properties":{"display_name":{"anyOf":[{"type":"string","maxLength":100,"minLength":2},{"type":"null"}],"title":"Display Name"},"role":{"anyOf":[{"$ref":"#/components/schemas/ProfileRole"},{"type":"null"}]},"bio":{"anyOf":[{"type":"string","maxLength":500},{"type":"null"}],"title":"Bio"},"city":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"City"},"latitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Latitude"},"longitude":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Longitude"},"services":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Services"},"photo_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Photo Url"},"name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Name"},"second_name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Second Name"},"email":{"anyOf":[{"type":"string","format":"email"},{"type":"null"}],"title":"Email"},"document_type":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Document Type"},"document":{"anyOf":[{"type":"string","maxLength":50},{"type":"null"}],"title":"Document"},"department":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Department"},"postal_code":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Postal Code"},"street":{"anyOf":[{"type":"string","maxLength":120},{"type":"null"}],"title":"Street"},"number":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Number"},"apartment":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Apartment"},"birth_date":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Birth Date"}},"type":"object","title":"ProfileUpdate"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}